<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>课表</title>
</head>
<body>
<div class="container-fluid">
    <div class="card mb-4 w-100">
        <div class="card-header"><i class="fas fa-table mr-1"></i>你的课程表</div>
        <div class="card-body">
            <table id="dataTable" class="table table-sm table-striped table-bordered text-center">
                <thead class="thead-light">
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">星期一</th>
                    <th scope="col">星期二</th>
                    <th scope="col">星期三</th>
                    <th scope="col">星期四</th>
                    <th scope="col">星期五</th>
                    <th scope="col">星期六</th>
                    <th scope="col">星期天</th>
                </tr>
                </thead>
                <tbody id="schedule">
                </tbody>
            </table>
        </div>
        <div class="card-footer">
            <div class="float-right">
                <button id="exportExcel" type="button" class="btn btn-primary">导出为EXCEL</button>
                <button id="savaSchedule" type="button" class="btn btn-info ">保存修改</button>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript" src="/plugin/datatables/DataTables-1.11.3/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="/plugin/datatables/DataTables-1.11.3/js/dataTables.bootstrap4.min.js"></script>
<script type="text/javascript" src="/plugin/sweetalert/sweetalert-2.1.2.min.js"></script>

<script type="text/javascript">
    $(function (){

        var mon=[];
        var tue=[];
        var wed=[];
        var thu=[];
        var fri=[];
        var sat=[];
        var sun=[];

        let editcell="<td><input class='w-100' style='height: 20px' type='checkbox'></td>"

        for (let i=1;i<14;i++){
            let row = "<tr><td scope='col'>"+i+editcell+editcell+editcell+editcell+editcell+editcell+editcell+"</tr>"
            $('#schedule').append(row)
        }

        function getTableData() {
            mon=[]
            tue=[]
            wed=[]
            thu=[]
            fri=[]
            sat=[]
            sun=[]
            let data=[]
            $.each($('#schedule td input'),function (index,dom){
                // let text = dom.checked//获取布尔值
                // data.push(text)
                if (dom.checked){
                    data.push(1)
                }else {
                    data.push(0)
                }
            })
            data.forEach(function (value, index, array) {
                switch (index%7){
                    case 0:{
                        mon.push(value)
                        break;
                    }
                    case 1:{
                        tue.push(value)
                        break
                    }
                    case 2:{
                        wed.push(value)
                        break
                    }
                    case 3:{
                        thu.push(value)
                        break
                    }
                    case 4:{
                        fri.push(value)
                        break
                    }
                    case 5:{
                        sat.push(value)
                        break;
                    }
                    case 6:{
                        sun.push(value)
                        break;
                    }
                    default:{
                        break;
                    }
                }
            })
            let totalclass = {
                "mon":mon,
                "tue":tue,
                "wed":wed,
                "thu":thu,
                "fri":fri,
                "sat":sat,
                "sun":sun
            }
            // console.log(totalclass)
            return totalclass;
        }

        $('#savaSchedule').click(function (){
            let json = JSON.stringify(getTableData())
            console.log(json)

            $.ajax({
                url:"",
                data:json,
                type:"POST",
                success:function (response) {
                    alert(response)
                },
                error:function (response) {
                    swal({
                        title:"错误",
                        icon:"error",
                        text:response.responseJSON.message
                    })
                }
            })
        })

        $('#exportExcel').click(function (){
            swal({
                title:"数据导出",
                icon:"warning",
                text:"还没写这个功能"
            })
        })
    })
</script>
</body>
</html>